<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="张凡在 Github 上的个人博客">
    <meta name="keyword" content="软件，算法，机器人">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="img/header-img.jpg">
    <link rel="alternate" type="application/atom+xml" title="longman" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        Netty实战｜longman&#39;s blog
        
    </title>

    <link rel="canonical" href="http://longman.kim/2018/07/20/Netty实战/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('img/post-default-img.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    longman
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="img/post-default-img.jpg">


<style>
    
    header.intro-header {
        background-image: url('img/post-default-img.jpg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>Netty实战</h1>
                    
                    <span class="meta">
                         作者 lewis longman
                        <span>
                          日期 2018-07-20
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            Netty实战
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <h3 id="1-Netty——异步和事件驱动"><a href="#1-Netty——异步和事件驱动" class="headerlink" title="1. Netty——异步和事件驱动"></a>1. Netty——异步和事件驱动</h3><ol>
<li>Java网络编程</li>
</ol>
<blockquote>
<ol>
<li>阻塞I/O<br>例如accept会一直阻塞到一个连接的建立，readLine会一直阻塞到换行符或者回车结尾的字符被读取。进一步，可以采用线程池处理多个请求，但存在大量的线程因为等待I/O数据就绪而处于休眠状态，并且需要为每个线程分配调用栈并切换上下文，同时虚拟机支持的线程数量有限。    </li>
<li>Java NIO, 非阻塞I/O<br>用setsocketopt()配置套接字，在读写调用没有数据时立即返回，当有任何套接字已经有数据可供读写时，使用操作系统的事件通知主线程。主线程中有一个selector，它可以监控多个Buffer相连，每个Buffer和一个Socket相连，当任何Buffer中有数据可读写时，selector就会选择该Buffer进行读写，即和该Buffer对应的Socket通信。  </li>
</ol>
</blockquote>
<ol start="2">
<li>Netty简介<blockquote>
<p>Netty的特点  </p>
<ol>
<li>设计<br>统一的API，支持多种传输类型，阻塞和非阻塞，简单而强大的线程模型，真正的无连接数据报套接字支持，链接逻辑组件以支持复用  </li>
<li>易于使用  </li>
<li>性能<br>比Java核心API更高的吞吐量以及更低的延迟，得益于池化和复用，拥有更低的资源消耗，最少的内存复制  </li>
<li>健壮性<br>不会因为慢速、快速或者超载的连接而导致OutOfMemoryError，消除在高速网络中NIO应用程序常见的不公平读/写比率  </li>
<li>安全性<br>完整的SSL/TLS以及StartTLS支持，可用于受限环境下  </li>
<li>社区驱动<br>发布快速而且频繁  </li>
</ol>
<p>Netty常用来做HTTP长连接，或者各种推送通知  </p>
<p>异步和事件驱动  </p>
</blockquote>
</li>
</ol>
<ol start="3">
<li>Netty的核心组件</li>
</ol>
<blockquote>
<ol>
<li>Channel<br>Channel是Java NIO的一个基本构造，代表一个到实体的开放连接，如读写操作。可以把Channel看作是传入（入站）和传出（出站）数据的载体，它可以被打开，被关闭，连接或者断开连接。  </li>
<li>回调<br>回调是一个方法，其他系统在某个操作完成后通知该系统时，就是调用的回调方法。  </li>
<li>Future<br>异步操作的结果的占位符，它将在未来的某个时候完成，并提供对其结果的访问。在JDK中只允许手动检测对应的操作是否已经完成，或者一直阻塞直到它完成。Netty中自己实现了ChannelFuture,用于异步操作。ChannelFuture能够注册一个或多个监听器ChannelFutureListener, 在操作完成时会调用监听器的operationComplete()方法，ChannelFutureListener提供的通知机制消除了手动检查对应操作是否完成的必要。每个Netty的传出I/O操作都将返回一个ChannelFuture，即它们不会阻塞，Netty是完成异步和事件驱动的。</li>
<li>事件和ChannelHandler<br>入站事件：连接已被激活或者连接失活，数据读取，用户事件，错误事件。<br>出站事件：打开或者关闭到远程节点的连接，将数据写到或者冲刷到套接字。<br>入站事件-&gt;入站处理器，出站-&gt;出站处理器<br>拦截操作以及高速地转换入站和出站数据，都只需要你提供回调函数或者利用操作返回的Future。Netty为每个Channel分配一个EventLoop来处理所有事件，包括注册感兴趣的事件，将事件派发给ChannelHandler, 安排进一步的动作。Netty的EventLoop是一个线程驱动，处理了一个Channel的所有I/O事件，并且在该EventLoop的整个生命周期内都不会变。      </li>
</ol>
</blockquote>
<h3 id="2-你的第一款Netty应用程序"><a href="#2-你的第一款Netty应用程序" class="headerlink" title="2. 你的第一款Netty应用程序"></a>2. 你的第一款Netty应用程序</h3><h3 id="3-Netty的组件和设计"><a href="#3-Netty的组件和设计" class="headerlink" title="3. Netty的组件和设计"></a>3. Netty的组件和设计</h3><h3 id="4-传输"><a href="#4-传输" class="headerlink" title="4. 传输"></a>4. 传输</h3><h3 id="5-ByteBuf"><a href="#5-ByteBuf" class="headerlink" title="5. ByteBuf"></a>5. ByteBuf</h3><h3 id="6-ChannelHandler和ChannelPipeline"><a href="#6-ChannelHandler和ChannelPipeline" class="headerlink" title="6. ChannelHandler和ChannelPipeline"></a>6. ChannelHandler和ChannelPipeline</h3><h3 id="7-Eventloop和线程模型"><a href="#7-Eventloop和线程模型" class="headerlink" title="7. Eventloop和线程模型"></a>7. Eventloop和线程模型</h3><h3 id="8-引导"><a href="#8-引导" class="headerlink" title="8. 引导"></a>8. 引导</h3><h3 id="9-单元测试"><a href="#9-单元测试" class="headerlink" title="9. 单元测试"></a>9. 单元测试</h3><h3 id="10-编解码器框架"><a href="#10-编解码器框架" class="headerlink" title="10. 编解码器框架"></a>10. 编解码器框架</h3><h3 id="11-预置的ChannelHandler和编解码器"><a href="#11-预置的ChannelHandler和编解码器" class="headerlink" title="11. 预置的ChannelHandler和编解码器"></a>11. 预置的ChannelHandler和编解码器</h3><h3 id="12-WebSocket"><a href="#12-WebSocket" class="headerlink" title="12. WebSocket"></a>12. WebSocket</h3><h3 id="13-使用UDP广播事件"><a href="#13-使用UDP广播事件" class="headerlink" title="13. 使用UDP广播事件"></a>13. 使用UDP广播事件</h3><h3 id="14-案例研究，第一部分"><a href="#14-案例研究，第一部分" class="headerlink" title="14. 案例研究，第一部分"></a>14. 案例研究，第一部分</h3><h3 id="15-案例研究，第二部分"><a href="#15-案例研究，第二部分" class="headerlink" title="15. 案例研究，第二部分"></a>15. 案例研究，第二部分</h3><h3 id="附录-Maven介绍"><a href="#附录-Maven介绍" class="headerlink" title="附录 Maven介绍"></a>附录 Maven介绍</h3>
                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2018/07/23/MongoDB/" data-toggle="tooltip" data-placement="top"
                           title="MongoDB">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2018/07/20/分布式事务与秒杀技巧/" data-toggle="tooltip" data-placement="top"
                           title="分布式事务与秒杀技巧">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                


                


                <!--加入新的评论系统-->
                
            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Netty——异步和事件驱动"><span class="toc-text">1. Netty——异步和事件驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-你的第一款Netty应用程序"><span class="toc-text">2. 你的第一款Netty应用程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Netty的组件和设计"><span class="toc-text">3. Netty的组件和设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-传输"><span class="toc-text">4. 传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ByteBuf"><span class="toc-text">5. ByteBuf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-ChannelHandler和ChannelPipeline"><span class="toc-text">6. ChannelHandler和ChannelPipeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Eventloop和线程模型"><span class="toc-text">7. Eventloop和线程模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-引导"><span class="toc-text">8. 引导</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-单元测试"><span class="toc-text">9. 单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-编解码器框架"><span class="toc-text">10. 编解码器框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-预置的ChannelHandler和编解码器"><span class="toc-text">11. 预置的ChannelHandler和编解码器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-WebSocket"><span class="toc-text">12. WebSocket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-使用UDP广播事件"><span class="toc-text">13. 使用UDP广播事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-案例研究，第一部分"><span class="toc-text">14. 案例研究，第一部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-案例研究，第二部分"><span class="toc-text">15. 案例研究，第二部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#附录-Maven介绍"><span class="toc-text">附录 Maven介绍</span></a></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; longman 2018
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://longman.kim/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="img/header-img.jpg">
</body>

</html>
