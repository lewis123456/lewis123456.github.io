<html>
<head>
	
	<title>大型网站技术架构-核心原理与案例分析</title>
	<meta name="keywords" content="longman" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css" />
    
        <script src="/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/header-img.jpg?v=3"/>
    
    

</head>

<body>


<h2 class="title">大型网站技术架构-核心原理与案例分析</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2018年7月11日




 </div>
--->
</div>

<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-大型网站架构演进"><span class="toc-text">1. 大型网站架构演进</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-大型网站结构模式"><span class="toc-text">2. 大型网站结构模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-大型网站核心架构要素"><span class="toc-text">3. 大型网站核心架构要素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-瞬时响应：网站的高性能架构"><span class="toc-text">4. 瞬时响应：网站的高性能架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-网站的高可用架构"><span class="toc-text">5. 网站的高可用架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-永无止境：网站的伸缩性架构"><span class="toc-text">6. 永无止境：网站的伸缩性架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-随需应变：网站的可扩展架构"><span class="toc-text">7. 随需应变：网站的可扩展架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-固若金汤：网站的安全架构"><span class="toc-text">8. 固若金汤：网站的安全架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-淘宝网的架构演化案例分析"><span class="toc-text">9. 淘宝网的架构演化案例分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-维基百科的高性能架构设计分析"><span class="toc-text">10. 维基百科的高性能架构设计分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-海量分布式存储系统Doris的高可用架构设计分析"><span class="toc-text">11. 海量分布式存储系统Doris的高可用架构设计分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-网购秒杀系统架构设计案例分析"><span class="toc-text">12. 网购秒杀系统架构设计案例分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-大型网站典型故障案例分析"><span class="toc-text">13. 大型网站典型故障案例分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-架构师领导艺术"><span class="toc-text">14. 架构师领导艺术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-网站架构师职场攻略"><span class="toc-text">15. 网站架构师职场攻略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-漫话网站架构师"><span class="toc-text">16. 漫话网站架构师</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#附录A-大型网站架构技术一览"><span class="toc-text">附录A 大型网站架构技术一览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#附录B-Web开发技术发展历程"><span class="toc-text">附录B Web开发技术发展历程</span></a></li></ol>
<h3 id="1-大型网站架构演进"><a href="#1-大型网站架构演进" class="headerlink" title="1. 大型网站架构演进"></a>1. 大型网站架构演进</h3><ol>
<li><p>大型网站软件系统的特点</p>
<blockquote>
<p>高并发，大流量，高可用，海量数据，用户分布广泛，网络情况复杂，安全环境恶劣，需求快速变更，发布频繁，渐进式发展  </p>
</blockquote>
</li>
<li><p>大型网站架构演化发展历程</p>
<blockquote>
<ol>
<li>初始阶段<br>LAMP单机</li>
<li>应用服务和数据服务分离  </li>
<li>使用缓存改善网站性能  </li>
<li>使用应用服务器集群改善网站的并发处理能力</li>
<li>数据库读写分离</li>
<li>使用反向代理和CDN加速网站响应  </li>
<li>使用分布式文件系统和分布式数据库系统</li>
<li>使用NoSQL和搜索引擎</li>
<li>业务拆分</li>
<li>分布式服务</li>
</ol>
</blockquote>
</li>
<li><p>大型网站架构演化的价值观</p>
<blockquote>
<ol>
<li>网站所需灵活应对</li>
<li>业务发展是驱动力</li>
</ol>
</blockquote>
</li>
<li><p>网站架构设计误区</p>
<blockquote>
<ol>
<li>一味追求大公司的解决方案</li>
<li>为了技术而技术</li>
<li>企图用技术解决所有问题</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="2-大型网站结构模式"><a href="#2-大型网站结构模式" class="headerlink" title="2. 大型网站结构模式"></a>2. 大型网站结构模式</h3><ol>
<li><p>网站架构模式</p>
<blockquote>
<ol>
<li>分层<br>应用层，服务层，数据层  </li>
<li>分割  </li>
<li>分布式<br>分布式应用和服务，分布式静态资源，分布式数据和存储，分布式计算，分布式配置，分布式锁，分布式文件系统</li>
<li>集群</li>
<li>缓存<br>CDN，反向代理，本地缓存，分布式缓存</li>
<li>异步<br>解耦，异步模式，生产者消费者，提高可用性，加快响应速度，消除并发访问高峰</li>
<li>冗余<br>冷备份，热备份，灾备数据中心</li>
<li>自动化<br>发布过程自动化，自动化代码管理，自动化测试，自动化安全检测，自动化部署，自动化监控，自动化报警，自动化失效转移，自动化失效恢复，自动化降级，自动化资源分配</li>
<li>安全<br>密码，手机校验码，加密，XSS攻击，SQL注入，信息过滤，风险控制</li>
</ol>
</blockquote>
</li>
<li><p>架构模式在新浪微博的应用</p>
<blockquote>
<ol>
<li>LAMP</li>
<li>基础服务层：数据库，缓存，存储，搜索</li>
<li>平台服务和应用服务</li>
<li>API和业务层</li>
<li>分布式部署，集群，异步推拉结合，多级缓存，冗余，自动化，安全</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="3-大型网站核心架构要素"><a href="#3-大型网站核心架构要素" class="headerlink" title="3. 大型网站核心架构要素"></a>3. 大型网站核心架构要素</h3><p>最高层次的规划，难以改变的决定</p>
<ol>
<li>性能<blockquote>
<ol>
<li>浏览器端，浏览器缓存，页面压缩，合理布局，减少cookie传输</li>
<li>CDN，动静分离，部署反向代理，缓存热点文件</li>
<li>服务端，本地缓存，分布式缓存，异步消息队列，集群，多线程，改善内存管理</li>
<li>数据库，索引，缓存，SQL优化，NoSQL</li>
<li>响应时间，TPS</li>
</ol>
</blockquote>
</li>
<li>可用性<blockquote>
<ol>
<li>7*24小时可用，4个9即99.99%可用</li>
<li>主要是手段是冗余</li>
<li>应用服务器，负载均衡，集群</li>
<li>存储服务器，实时备份</li>
</ol>
</blockquote>
</li>
<li>伸缩性<blockquote>
<ol>
<li>应用服务器用合适的负载均衡器向集群中加机器</li>
<li>缓存服务器，改进缓存路由算法，保证缓存的可访问性</li>
<li>关系数据库支持数据复制，主从热备等机制，但很难保证大规模的伸缩性。主要通过路由分区将多个数据库的服务器组成一个集群。NoSQL比较好扩展。</li>
</ol>
</blockquote>
</li>
<li>扩展性<blockquote>
<p>如何设计网站的架构使其能够快速响应需求的变化。</p>
<ol>
<li>事件驱动架构<br>消息队列</li>
<li>分布式服务<br>将业务和可复用服务分离，通过分布式服务框架调用。</li>
</ol>
</blockquote>
</li>
<li>安全性<blockquote>
<p>保护数据</p>
</blockquote>
</li>
</ol>
<h3 id="4-瞬时响应：网站的高性能架构"><a href="#4-瞬时响应：网站的高性能架构" class="headerlink" title="4. 瞬时响应：网站的高性能架构"></a>4. 瞬时响应：网站的高性能架构</h3><ol>
<li>网站性能测试<blockquote>
<ol>
<li>响应时间，请求开始到收到响应所需的时间</li>
<li>并发数，系统能够同时处理请求的数目</li>
<li>吞吐量，TPS（每秒事务数），QPS（每秒查询数），HPS（每秒HTTP请求数）</li>
<li>性能技术器<br>系统负载，对象与线程数，内存使用，CPU使用，磁盘与网络I/O</li>
<li>性能测试方法<br>性能测试，负载测试（直到处理能力下降），压力测试（直到系统崩溃或不能处理任何请求），稳定性测试（不同环境）</li>
</ol>
</blockquote>
</li>
<li>Web前端性能优化<blockquote>
<ol>
<li>减少http请求</li>
<li>使用浏览器缓存</li>
<li>启用压缩</li>
<li>css放在页面最上面，javasript放在页面最下面</li>
<li>减少cookie传输</li>
<li>CDN缓存静态资源</li>
<li>反向代理缓存</li>
</ol>
</blockquote>
</li>
<li>应用服务器性能优化<blockquote>
<ol>
<li>分布式缓存<br>Hash表，读多写少，二八定律</li>
<li>合理使用缓存<br>频繁修改的数据不适合缓存，非热点数据不适合缓存，可能存在数据不一致和脏读，缓存的可用性，缓存利用LRU(最近最久未用算法)，缓存预热，缓存穿透</li>
<li>分布式缓存架构<br>更新同步的缓存（与应用部署在一起），互不通信的缓存（与应用部署在不同的服务器，采用Hash一致性算法可伸缩）。Memcached采用TCP通信，序列化协议基于文本的自定义，网络通信基于libevent，内存管理使用固定空间分配，存储时根据数据的size寻找一个大于size的最小的chunk，互不通信的服务器集群架构。</li>
<li>异步操作<br>使用消息队列</li>
<li>使用集群<br>负载均衡</li>
<li>代码优化<br>多线程，线程安全（将对象设计为无状态对象，使用局部对象，并发访问资源时使用锁），资源复用（单例模式，线程池），数据结构，垃圾回收</li>
</ol>
</blockquote>
</li>
<li>存储性能优化<blockquote>
<ol>
<li>机械硬盘和固态硬盘</li>
<li>B+树和LSM树</li>
<li>RAID（廉价磁盘冗余阵列）和HDFS（MapReduce）</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="5-网站的高可用架构"><a href="#5-网站的高可用架构" class="headerlink" title="5. 网站的高可用架构"></a>5. 网站的高可用架构</h3><ol>
<li>网站可用性的度量与考核<blockquote>
<p>网站不可用时间，网站年度可用性指标（多少个9）</p>
</blockquote>
</li>
<li>高可用的网站架构<blockquote>
<p>保证服务器硬件故障时服务依然可用、数据依然保存并能够被访问，手段主要是数据和服务的冗余备份及失效转移。应用层使用负载均衡应对高并发，心跳机制将问题服务器从集群中剔除。服务层使用RPC框架，在客户端使用软负载均衡，服务注册中心剔除不可用服务器。数据层需要写入数据时同步复制，实现数据冗余。</p>
</blockquote>
</li>
<li>高可用的应用<blockquote>
<ol>
<li>无状态应用</li>
<li>使用负载均衡进行失效转移</li>
<li>session管理的发展，seesion复制-&gt;session绑定(hash)-&gt;利用cookie记录session-&gt;session服务器</li>
</ol>
</blockquote>
</li>
<li>高可用的服务<blockquote>
<ol>
<li>服务器分级管理，物理机&gt;虚拟机，线程隔离</li>
<li>超时设置</li>
<li>异步调用</li>
<li>服务降级，拒绝服务，关闭功能</li>
<li>幂等设计</li>
</ol>
</blockquote>
</li>
<li>高可用的数据<blockquote>
<ol>
<li>数据多备份，实现持久化，并在失效时，快速切换访问数据的副本。</li>
<li>整个网站共享同一个分布式缓存集群</li>
<li>CAP原理，优先保证AP，数据一致性保证最终一致性</li>
<li>数据冷备采用定期备份，不能保证最终一致性，不能保证数据可用性。数据热备分为异步热备（成功写一份，异步写其他副本）和同步热备（多份数据副本同步写入）。关系数据库热备使用master，slave同步机制。读写分离，只写master，只读slave。</li>
<li>失效转移（将宕机服务器的读写请求路由到其他服务器）。失效确认，应用程序访问失败报告和控制中心的心跳检测。访问转移，重新路由，需要考虑存储不对等的情况。数据恢复，数据复制。</li>
</ol>
</blockquote>
</li>
<li>高可用网站的软件质量保证<blockquote>
<ol>
<li>网站发布<br>发布过程中，每次关闭集群中的一小部分服务器，发布完后可以立即访问，不影响用户</li>
<li>自动化测试<br>自动化测试工具Selenium</li>
<li>预发布验证<br>预发布服务器没有配置在负载均衡器上，只运行开发和测试访问。处理错误的一个理念是快速失败。</li>
<li>代码控制<br>分支开发，主干发布</li>
<li>自动化发布<br>固定发布日期</li>
<li>灰度发布<br>每天发布一部分服务器</li>
</ol>
</blockquote>
</li>
<li>网站运行监控<blockquote>
<p>不允许没有监控的服务上下</p>
<ol>
<li>监控数据采集<br>服务器端日志收集，客户端浏览器日志收集，实时计算框架storm的日志统计与分析，服务器性能监控（系统load、内存占用、磁盘IO、网络IO）Ganglia，运行数据报告（缓存命中率、平均响应延迟时间、待处理任务总数）</li>
<li>监控管理<br>系统报警，失效转移，自动优雅降级</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="6-永无止境：网站的伸缩性架构"><a href="#6-永无止境：网站的伸缩性架构" class="headerlink" title="6. 永无止境：网站的伸缩性架构"></a>6. 永无止境：网站的伸缩性架构</h3><ol>
<li><p>网站架构的伸缩性设计</p>
<blockquote>
<ol>
<li>不同功能进行物理分隔实现伸缩<br>纵向分离（分层后分离），横向分离（业务分隔后分离）</li>
<li>单一功能通过集群规模实现伸缩</li>
</ol>
</blockquote>
</li>
<li><p>应用服务器集群的伸缩性设计</p>
<blockquote>
<ol>
<li>HTTP重定向负载均衡，返回浏览器302</li>
<li>DNS域名解析负载均衡，一个域名多个IP</li>
<li>反向代理负载均衡，应用层（HTTP）负载均衡</li>
<li>IP负载均衡，修改目的地址的IP</li>
<li>数据链路层负载均衡，直接路由方式（DR），不修改IP修改MAC，LVS工作在这层</li>
<li>负载均衡算法<br>轮训（Round Robin, RR），加权轮训（Weighted Round Robin, WRR），随机，最少连接，源地址散列（hash）</li>
</ol>
</blockquote>
</li>
<li>分布式缓存集群的伸缩性设计<blockquote>
<p>新加入缓存服务器后使整个缓存服务器集群中已经缓存的数据尽可能还被访问到。</p>
<ol>
<li>Memcached分布式缓存集群的访问机制</li>
<li>分布式缓存的一致性Hash算法，虚拟节点</li>
</ol>
</blockquote>
</li>
<li>数据存储服务器集群的伸缩性设计<blockquote>
<ol>
<li>关系数据库集群的伸缩性设计<br>数据分库，跨库的表不能进行Join操作。进行了分库和主从复制后，单表数据仍很大，需要将一张表拆开分别存储在多个数据库中，即分片。支持数据分片的分布式数据库产品主要有Amoeba和Cobar。Cobar做负载均衡，MySQL做数据迁移。避免事务或者利用补偿机制代替数据库事务，分解数据访问逻辑避免JOIN操作。</li>
<li>NoSQL数据库的伸缩性设计<br>HBase的架构，HBase依赖可分裂的HRegion以及可伸缩的分布式文件系统HDFS。Zookeeper，HMaster，HRegionServer，HRegion。</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="7-随需应变：网站的可扩展架构"><a href="#7-随需应变：网站的可扩展架构" class="headerlink" title="7. 随需应变：网站的可扩展架构"></a>7. 随需应变：网站的可扩展架构</h3><ol>
<li>构建可扩展的网站架构<blockquote>
<p>扩展性（开闭原则，对扩展开放，对修改关闭），伸缩性（增加资源规模提高系统处理能力），模块化，降低模块之间的耦合</p>
</blockquote>
</li>
<li>利用分布式消息队列降低系统耦合性<blockquote>
<ol>
<li>事件驱动架构<br>生成者消费者模式就是常见的事件驱动模式，分布式消息队列。</li>
<li>分布式消息队列<br>FIFO，通过消息对象分解系统耦合性</li>
</ol>
</blockquote>
</li>
<li>利用分布式服务打造可复用的业务平台<blockquote>
<p>通过接口分解系统耦合性，不同子系统通过相同的接口描述进行服务调用</p>
<ol>
<li>WebService与企业级分布式服务</li>
<li>大型网站分布式服务的需求与特点<br>负载均衡，失效转移，高效的远程通信，整合异构系统，对应用最少侵入，版本管理，实时监控</li>
<li>分布式服务框架设计<br>Dubbo，服务框架客户端，服务注册中心，负载均衡策略，服务提供者</li>
</ol>
</blockquote>
</li>
<li>可扩展的数据结构<blockquote>
<p>关系数据库的schema，NoSQL的ColumnFamily</p>
</blockquote>
</li>
<li>利用开放平台建设网站生态圈<blockquote>
<ol>
<li>API接口</li>
<li>协议转换</li>
<li>安全</li>
<li>审计</li>
<li>路由</li>
<li>流程</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="8-固若金汤：网站的安全架构"><a href="#8-固若金汤：网站的安全架构" class="headerlink" title="8. 固若金汤：网站的安全架构"></a>8. 固若金汤：网站的安全架构</h3><ol>
<li>网站应用攻击与防御<blockquote>
<ol>
<li>XSS攻击<br>反射型，嵌入恶意脚本的链接，持久型，黑客提交恶意脚本到正常页面。防护手段有消毒，即对危险字符进行转义。HttpOnly，禁止访问cookie。</li>
<li>注入攻击<br>SLQ注入攻击，在请求中注入恶意SQL命令。黑客获取数据库结构的手段，开源，错误回显，盲注。防护手段有消毒，正则匹配过滤SQL。参数绑定，预编译。</li>
<li>CSRF攻击<br>通过跨站请求，以合法身份进行非法操作，其核心是利用了浏览器的cookie或者服务器的session策略，盗用用户身份。防御手段有表单token，验证码，referer check。</li>
<li>其他攻击和漏洞<br>error code，HTML注释，文件上传，路径遍历</li>
<li>Web应用防火墙<br>ModSecurity</li>
<li>网站安全漏洞扫描</li>
</ol>
</blockquote>
</li>
<li>信息加密技术及密钥安全管理<blockquote>
<ol>
<li>单向散列加密<br>密码保存与验证，加盐salt增加破解难度，MD5，SHA</li>
<li>对称加密<br>DES算法，RC算法</li>
<li>非对称加密算法<br>RSA算法，HTTPS里面的数字证书</li>
<li>密钥安全管理<br>密钥和算法放在独立的服务器上甚至做出专用硬件，加解密算法放在应用中，密钥放在独立的服务器中，密钥分片存储</li>
</ol>
</blockquote>
</li>
<li>信息过滤与反垃圾<blockquote>
<ol>
<li>文本匹配<br>正则匹配，Tri树，多级Hash表</li>
<li>分类算法<br>朴素贝叶斯分类，聚类挖掘</li>
<li>黑名单</li>
</ol>
</blockquote>
</li>
<li>电子商务风险控制<blockquote>
<ol>
<li>风险<br>账户风险，买家风险，卖家风险，交易风险</li>
<li>风控<br>规则引擎，统计模型</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="9-淘宝网的架构演化案例分析"><a href="#9-淘宝网的架构演化案例分析" class="headerlink" title="9. 淘宝网的架构演化案例分析"></a>9. 淘宝网的架构演化案例分析</h3><h3 id="10-维基百科的高性能架构设计分析"><a href="#10-维基百科的高性能架构设计分析" class="headerlink" title="10. 维基百科的高性能架构设计分析"></a>10. 维基百科的高性能架构设计分析</h3><h3 id="11-海量分布式存储系统Doris的高可用架构设计分析"><a href="#11-海量分布式存储系统Doris的高可用架构设计分析" class="headerlink" title="11. 海量分布式存储系统Doris的高可用架构设计分析"></a>11. 海量分布式存储系统Doris的高可用架构设计分析</h3><h3 id="12-网购秒杀系统架构设计案例分析"><a href="#12-网购秒杀系统架构设计案例分析" class="headerlink" title="12. 网购秒杀系统架构设计案例分析"></a>12. 网购秒杀系统架构设计案例分析</h3><h3 id="13-大型网站典型故障案例分析"><a href="#13-大型网站典型故障案例分析" class="headerlink" title="13. 大型网站典型故障案例分析"></a>13. 大型网站典型故障案例分析</h3><h3 id="14-架构师领导艺术"><a href="#14-架构师领导艺术" class="headerlink" title="14. 架构师领导艺术"></a>14. 架构师领导艺术</h3><h3 id="15-网站架构师职场攻略"><a href="#15-网站架构师职场攻略" class="headerlink" title="15. 网站架构师职场攻略"></a>15. 网站架构师职场攻略</h3><h3 id="16-漫话网站架构师"><a href="#16-漫话网站架构师" class="headerlink" title="16. 漫话网站架构师"></a>16. 漫话网站架构师</h3><h3 id="附录A-大型网站架构技术一览"><a href="#附录A-大型网站架构技术一览" class="headerlink" title="附录A 大型网站架构技术一览"></a>附录A 大型网站架构技术一览</h3><h3 id="附录B-Web开发技术发展历程"><a href="#附录B-Web开发技术发展历程" class="headerlink" title="附录B Web开发技术发展历程"></a>附录B Web开发技术发展历程</h3>

<!--<a href="http://longman.kim/2018/07/11/大型网站技术架构-核心原理与案例分析/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script>
</div>






</body>
</html>